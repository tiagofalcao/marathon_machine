---

- name: Setting Network Interfaces
  when: ansible_distribution == 'Ubuntu'
  template: src=interfaces.j2 dest=/etc/network/interfaces
  notify: Restart Network

- name: Setting Internal Interface
  when: ansible_distribution == 'Ubuntu'
  template: src=internal.j2 dest=/etc/network/interfaces.d/internal.cfg
  notify: Restart Network

- name: Setting External Interface
  when: ansible_distribution == 'Ubuntu'
  template: src=external.j2 dest=/etc/network/interfaces.d/external.cfg
  notify: Restart Network

- name: Install UFW
  when: ansible_distribution == 'Ubuntu'
  action: apt pkg={{item}} state=installed
  with_items:
  - ufw

- lineinfile:
    path: /etc/default/ufw
    regexp: '^DEFAULT_FORWARD_POLICY='
    line: 'DEFAULT_FORWARD_POLICY="ACCEPT"'

- lineinfile:
    path: /etc/ufw/sysctl.conf
    regexp: '^.?net.ipv4.ip_forward='
    line: 'net.ipv4.ip_forward=1'

- lineinfile:
    path: /etc/ufw/sysctl.conf
    regexp: '^.?net/ipv6/conf/default/forwarding='
    line: 'net/ipv6/conf/default/forwarding=1'

- lineinfile:
    path: /etc/ufw/sysctl.conf
    regexp: '^.?net/ipv6/conf/all/forwarding'
    line: 'net/ipv6/conf/all/forwarding=1'

- ufw:
    state: enabled
    policy: allow

